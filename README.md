# CRISPR
Levenshtein Generator for CRISPR-Cas9

CRISPR-Cas9 recognizes DNA subsequences that are complementary to a short RNA sequence. In order for CAS9 to work, it requires a special Protospacer Adjacent Motif (PAM). In the case of our work, our PAM is NGG.

To Clone:
```
	git clone -b toms --recurse-submodules https://github.com/tjt7a/CRISPR

```

We use the VASim CPU simulator to build and simulate automata. To install and run VASim:

Go to lib/VASim and run 'make'
```
	cd ./lib/VASim
	make
```

We also use HScompile to run automata with Hyperscan. To install and build Hyperscan:
Go to lib/hscompile:
```
	cd ./lib/hscompile/lib/hyperscan_for_hscompile
	mkdir build
	cd build
	cmake .. -DFAT_RUNTIME=off
	make

	cd ./lib/hscompile/lib/mnrl/C++
	make

	mkdir build
	cd build
	cmake -DHS_SOURCE_DIR=../lib/hyperscan_for_hscompile -DMNRL_SOURCE_DIR=../lib/mnrl/C++ ..
	make
```

To build the levenshtein generator (lev):

Go to ./lev and run 'make'
```
	cd lev
	make
```

The levenshtein directory contains the levenshtein automata generated by AutomataZoo/Levenshtein/code/lev
We generated each levenshtein automaton from the gRNA sequence with or without PAM.

1. Investigate segment contains PAM, and segment without PAM:
	```
	cat sequences/sgRNA_with_PAM
		GTCCCTAGTGGCCCCACTGTNGG

	cat sequences/sgRNA_without_PAM
		GTCCCTAGTGGCCCCACTGT
	```

2. Generate a Levenshtein automaton from the sequence without PAM
	```
	./lev/lev -d 4 -f sequences/sgRNA_without_PAM
	mv lev_1_4.anml  sgRNA_without_PAM.anml
	```

	To visualize the resulting automaton, use VASim and DOT:
	```
	./lib/VASim/vasim -d sgRNA_without_PAM.anml
	dot -Tpng -o sgRNA_without_PAM.png automata_0.dot
	```
	[<p align="center"><img src="./levenshtein/without_pam/sgRNA_without_PAM.png" width="600" ></p>](#without_pam_dot)


3. Generate a Levenshtein automaton from the sequence with PAM by making all reporting states point to the first base in the PAM (N), and making the last G report
	```
	./lev/lev -d 4 -f sequences/sgRNA_without_PAM -p
	mv lev_1_4_PAM.anml sgRNA_PAM.anml
	```

	```
	./lib/VASim/vasim -d sgRNA_PAM.anml
	dot -Tpng -o sgRNA_PAM.png automata_0.dot
	```

	[<p align="center"><img src="./levenshtein/with_pam/sgRNA_PAM.png" width="600" ></p>](#with_pam_dot)


5. Translate ANML automata into MNRL automata to work with hscompile:
	```
	./lib/VASim/vasim -m sgRNA_PAM.anml
	mv automata_0.mnrl sgRNA_PAM.mnrl
	```

6. Compile the resulting Levenshtein + PAM automaton into a Hyperscan database with hscompile
	```
	./lib/hscompile/build/hscompile sgRNA_PAM.mnrl sgRNA_PAM.hs
	```

7. Run the database against the forward-strand genome:
	```
 	gunzip genomes/forward/forward_hg38_no_n.txt.gz
	./lib/hscompile/build/hsrun sgRNA_PAM.hs genomes/forward/forward_hg38_no_n.txt
	```
